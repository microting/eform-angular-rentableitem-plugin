<subheader-pn [title]="'Inspections' | translate">
  <div class="p-3">
  </div>
</subheader-pn>

<div class="container-fluid">
  <div class="row pl-1">
    <div class="col-md-2">
      <div class="md-form">
        <!--        <input mdbInput-->
        <!--               type="text" (input)="onSearchInputChanged($event.target.value)"-->
        <!--               class="form-control input-sm" id="searchInput">-->
        <!--        <label for="searchInput">{{'Search' | translate}}</label>-->
      </div>
    </div>
  </div>
  <div class="row p-1 table-responsive no-gutters">
    <table mdbTable striped="true" hover="true" small="true" class="z-depth-1 text-center">
      <thead>
      <tr>
        <th scope="col" class="table-header-sortable" id="idSort"
            (click)="sortByColumn('Id', contractInspectionsRequestModel.isSortDsc = !contractInspectionsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            ID
            <i class="material-icons text-black-50" *ngIf="contractInspectionsRequestModel.sortColumnName != 'Id'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractInspectionsRequestModel.sortColumnName == 'Id' && !contractInspectionsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractInspectionsRequestModel.sortColumnName == 'Id' && contractInspectionsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="contractNumberSort"
            (click)="sortByColumn('ContractNumber',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Contract Number' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'ContractNumber'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'ContractNumber' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'ContractNumber' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="customerIdSort"
            (click)="sortByColumn('CustomerId',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Customer' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'CustomerId'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'CustomerId' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'CustomerId' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="brandSort"
            (click)="sortByColumn('Brand',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Brand' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'Brand'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'Brand' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'Brand' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="modelSort"
            (click)="sortByColumn('ModelName',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Model' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'ModelName'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'ModelName' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'ModelName' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="regDateSort"
            (click)="sortByColumn('RegistrationDate',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Reg. date' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'RegistrationDate'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'RegistrationDate' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'RegistrationDate' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="vinNumberSort"
            (click)="sortByColumn('VinNumber',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Vin no.' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'VinNumber'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'VinNumber' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'VinNumber' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="startDateSort"
            (click)="sortByColumn('StartDate',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'Start date' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'StartDate'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'StartDate' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'StartDate' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="endDateSort"
            (click)="sortByColumn('EndDate',contractsRequestModel.isSortDsc = !contractsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            {{'End date' | translate}}
            <i class="material-icons text-black-50" *ngIf="contractsRequestModel.sortColumnName != 'EndDate'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'EndDate' && !contractsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractsRequestModel.sortColumnName == 'EndDate' && contractsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="doneAtSort"
            (click)="sortByColumn('doneAt', contractInspectionsRequestModel.isSortDsc = !contractInspectionsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            Done at
            <i class="material-icons text-black-50" *ngIf="contractInspectionsRequestModel.sortColumnName != 'doneAt'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractInspectionsRequestModel.sortColumnName == 'doneAt' && !contractInspectionsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractInspectionsRequestModel.sortColumnName == 'doneAt' && contractInspectionsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col" class="table-header-sortable" id="statusSort"
            (click)="sortByColumn('Status', contractInspectionsRequestModel.isSortDsc = !contractInspectionsRequestModel.isSortDsc)">
          <div class="d-flex align-items-center justify-content-center">
            Status
            <i class="material-icons text-black-50" *ngIf="contractInspectionsRequestModel.sortColumnName != 'Status'">
              unfold_more</i>
            <i class="material-icons"
               *ngIf="contractInspectionsRequestModel.sortColumnName == 'Status' && !contractInspectionsRequestModel.isSortDsc">
              expand_less</i>
            <i class="material-icons"
               *ngIf="contractInspectionsRequestModel.sortColumnName == 'Status' && contractInspectionsRequestModel.isSortDsc">
              expand_more</i>
          </div>
        </th>
        <th scope="col">
          {{ 'Actions' | translate }}
        </th>
      </tr>
      </thead>
      <tbody id="tableBody">
      <tr *ngFor="let inspection of contractInspectionsModel?.contractInspections">
        <td id="inspectionId">
          {{inspection.id}}
        </td>
        <td id="inspectionContractId">
          {{inspection.contractId}}
        </td>
        <ng-template #popTemplate>
          <div>{{inspection.rentableItemCustomer.customerNo}}</div>
          <div><strong>{{'Address: ' | translate }}</strong> {{inspection.rentableItemCustomer.companyAddress}}</div>
          <div><strong>{{'Address 2: ' | translate }}</strong> {{inspection.rentableItemCustomer.companyAddress2}}</div>
          <div><strong>{{'City Name: ' | translate}}</strong> {{inspection.rentableItemCustomer.cityName}}</div>
          <div><strong>{{'Zip Code: ' | translate }}</strong> {{inspection.rentableItemCustomer.zipCode}}</div>
          <div><strong>{{'Phone: ' | translate}}</strong> {{inspection.rentableItemCustomer.phone}}</div>
          <div><strong>{{'Email: ' | translate}}</strong> {{inspection.rentableItemCustomer.email}}</div>
          <div><strong>{{'EAN Code: ' | translate}}</strong> {{inspection.rentableItemCustomer.eanCode}}</div>
          <div><strong>{{'Vat Number: ' | translate}}</strong> {{inspection.rentableItemCustomer.vatNumber}}</div>
          <div><strong>{{'Country Code: ' | translate}}</strong> {{inspection.rentableItemCustomer.countryCode}}</div>
        </ng-template>
        <td id="contractCustomer" [mdbPopover]="popTemplate"
            placement="right"  mdbPopoverHeader="{{'Customer' | translate }}" triggers="mouseenter:mouseleave">
          <span *ngIf="inspection.rentableItemCustomer != undefined">
            {{inspection.rentableItemCustomer.companyName}}
            <br *ngIf="inspection.rentableItemCustomer.contactPerson !== null">
            {{inspection.rentableItemCustomer.contactPerson}}
          </span>
        </td>
        <td id="brand">
          <div *ngFor="let rentableItem of inspection.rentableItems">
            {{rentableItem.brand}}
          </div>
        </td>
        <td id="model">
          <div *ngFor="let rentableItem of inspection.rentableItems">
            {{rentableItem.modelName}}
          </div>
        </td>
        <td id="regdate">
          <div *ngFor="let rentableItem of inspection.rentableItems">
            {{rentableItem.registrationDate | date:'dd/MM/yyyy'}}
          </div>
        </td>
        <td id="vinNo">
          <div *ngFor="let rentableItem of inspection.rentableItems">
            {{rentableItem.vinNumber}}
          </div>
        </td>
        <td id="contractStart">
          {{inspection.contractStart | date:'dd/MM/yyyy'}}
        </td>
        <td id="contractEnd">
          {{inspection.contractEnd | date:'dd/MM/yyyy'}}
        </td>
        <td id="inspectionDoneAt">
          {{inspection.doneAt | date:'dd/MM/yyyy hh:mm:ss:'}}
        </td>
        <td id="inspectionStatus">
          <status-bar [status]="inspection.status"></status-bar>
        </td>
        <td>
          <div class="d-flex flex-row justify-content-center">
            <button mdbBtn class="btn-success btn-icon mb-2" *ngIf="inspection.status === 100"
                    [routerLink]="['../case/' + inspection.sdkCaseId + '/' + inspection.eFormId + '/' + inspection.rentableItemCustomer.id + '/' + inspection.rentableItems[0].id]"
                    mdbTooltip="{{ 'Edit Case' | translate }}">
              <fa-icon icon="pen" size="lg" [fixedWidth]="true"></fa-icon>
            </button>
            <button mdbBtn class="btn-success btn-icon mb-2"
                    mdbTooltip="{{ 'Get PDF' | translate }}"
                    (click)="downloadPDF(inspection)" *ngIf="inspection.status === 100">
              <fa-icon icon="file-pdf" size="lg" [fixedWidth]="true" ></fa-icon>
            </button>
            <button mdbBtn class="btn-success btn-icon mb-2"
                    mdbTooltip="{{ 'Get DOCX' | translate }}"
                    (click)="downloadDocx(inspection)" *ngIf="inspection.status === 100">
              <fa-icon icon="file-word" size="lg" [fixedWidth]="true"></fa-icon>
            </button>
            <button mdbBtn class="btn-danger btn-icon mb-2"
                    mdbTooltip="{{'Delete Inspection' | translate}}"
                    (click)="showDeleteInspectionModal(inspection)"
                    id="deleteInspectionBtn">
              <fa-icon icon="trash-alt" [fixedWidth]="true" size="lg"></fa-icon>
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <div class="row justify-content-between mr-2 ml-2">
    <div class="col-md-1">
      <page-size-pn
        [pageSize]="localPageSettings.pageSize"
        (onPageSizeChanged)="localPageSettings.pageSize = $event; contractInspectionsRequestModel.pageIndex = 1;
      updateLocalPageSettings()">
      </page-size-pn>
    </div>
    <div class="col-md-4 ml-auto d-flex justify-content-end p-2">
      <pagination-pn *ngIf="contractsModel.total > contractInspectionsRequestModel.pageSize"
                     [limit]="contractInspectionsRequestModel.pageSize"
                     [size]="contractsModel.total"
                     [offset]="contractInspectionsRequestModel.offset"
                     (onPageChanged)="changePage($event)"></pagination-pn>
    </div>
  </div>
</div>

<app-inspections-add #createInspectionModal></app-inspections-add>
<app-inspections-update #editInspectionModal></app-inspections-update>
<app-contract-inspections-delete #deleteInspectionModal
                                 (onContractInspectionDeleted)="getAllInspections()"></app-contract-inspections-delete>
